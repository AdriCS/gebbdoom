\section{Memory Manager}
Like all game engine of the era, \doom did not trust stock \cw{malloc}, not even the one provided by Watcom with \cw{libc}. Because it could lead to memory fragmentation, a standard allocator would have jeopardized the stability of the engine. They were also wasteful for optimized for big chunk allocation which is not what the engine does. They also lacked good debugging tools. For all these reason \doom uses its own memory manager (MM).\\
\par

The engine runs on a very clearly established memory budget. Upon starting up on \NeXT the MM allocates 4 MiB of RAM an not a byte more.On DOS the MM checks whether the machine has at least 4 MiB but will use more if there is available to improve its cache retention.\\
\par
The original based on zones gave its name to the system and as a result this part is hosted in \cw{z\_zone.c}. However the concept was abandoned in favor of a tag system allowing memory block allocated to be marked and recognized for a certain purpose.\\
\par
\ccode{memory_zone.c}
\par
\cw{PU\_LEVEL} for example allows \doom to free all memory between levels without any tracking. The engine simply ask the zone memory manage to free all blocks tagged \cw{PU\_LEVEL}. An other powerful tag is \cw{PU\_CACHE} which allows the memory system to free a block by itself if it cannot complete an allocation request. \\
\par
  
\par
\trivia{The allocator code is not entirely common to both DOS and \NeXT. The RAM system is need to provide \cw{I\_ZoneBase}.\\
\par \tcode{zone_undefined.txt}}
\par
%\trivia{Dave Taylor had his own TAG: \cw{PU\_DAVE}, which was used for "anything else Dave wants static". Unfortunately this tag was never used.}


DRAWING\\
MEmory budget:\\
- Video system
- visplanes
\par
Maybe memory footprint of -timedemo demo3?\\
\pagebreak