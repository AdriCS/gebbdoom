\section{Video System}
At first glance the video output system, the (VGA) Video Graphic Array, was still the same weird beast Wolfenstein 3D had to deal with. With its infamous 300 registers to configure it, its palette system limiting colors to 256, and the awkward four banks of 64 KiB mandating interleaved framebuffer the VGA was an unappealing programming interface.\\
\par
A GC (Graphic Controller) and a (SC) Sequence Controller controlled access to 256 KiB of Video RAM. A CRTC (Cathode Ray Tube Controller) controlled how the framebuffer was sampled. And finally a DAC took care of converting Digital data to analogic toward the CRT monitor.\\
\par 	
\scaleddrawing{0.6}{vga}{}
\par
At this point in time, all video games used the VGA in tweaked mode 13h which offered a resolution of 320x200, 1 byte per pixel, 256 colors palette. Using undocumented tricks, developers used directly the four banks in the video card. How the framebuffer was layout accross banks was far from being trivia. Due to historically slow RAM access time, pixels had to be interleaved four by four.\\
\par
\par
\cscaledimage{0.9}{vga_ram_screen_layout}{\label{vga_ram_screen_layout}}
\par
In figure \ref{vga_ram_screen_layout}, notice how the first pixel \cw{0} is stored in bank 0, \cw{1} is stored in bank 1 and so on. With an horizontal resolution of 320, 80 pixels are stored in each banks.\\
\par
To access the 256 KiB of VRAM, Intel had established a hard-coded memory mapping in RAM from \cw{0xA0000} to \cw{0xAFFFF}. An eye accustomed to hexadecimal will have immediately noticed that \cw{0xFFFF} translates to 64KiB addresses, far fewer than the total available VRAM.\\
\par
 In order to compensate for the lack of addresses, IBM had designed a bank switching system managed through a \textit{map mask register}. In practice this meant a RAM address within \cw{0xA0000} to \cw{0xAFFFF} could correspond to four locations in VRAM as shown in figure \ref{ram_vram_mapping}.\\


\par
\scaleddrawing{0.7}{vga_mapping}{\label{ram_vram_mapping}}
\par
And if all these difficulties were not enough, because the framebuffer aspect ratio did not match the CRT monitor aspect ratio, the framebuffer was distorted.\\
\par
\par
\cfullimage{circleframebuffer.png}{\label{circleframebuffer}}
\par
In figure \label{circleframebuffer} a programmer drew a circle into the framebuffer, notice the $ 320/200 = 1.6 $ aspect ratio.
\par
\cfullimage{circlescreen.png}{What the same framebuffer looked like on the monitor. Notice the $ 320/240 = 1.333 $ aspect ratio.}
\par







\section{A Witty Section Name Here}
Despite this bleak description, a closer inspection of the world of PC graphic unveiled two tremendous changes which ended up deeply impacting \doom. \\
\par
Since 1992 with the released of Microsoft and IBM new operating systems (respectiely OS/2 2.0 and Microsoft Windows 3.1 (1992)), the demand for fast graphic card had been growing strong. It was a huge technological leap to request devices pushing 4,000 bytes of information\footnote{2,000 bytes for the characters, and 2,000 bytes for screen attributes} in text mode to instead move 300,000 bytes\footnote{256 colors at 640x480}.\\
\par

\cfullimage{Windows311workspace.png}{Despite its simple interface, Windows 3.11 640x480 16 colors was able to put PCs on their knees.}



\subsection{VGA Chip manufacturer}
The first improvement came from VGA chip manufacturers. Some of them such as ATI, Cirrus Logic and Tseng Labs went through great effort to achieve higher performances. Hardware GUI acceleration had not yet become mainstream, and so host-throughput was the dominating factor in a graphical-application's redraw speed. As many components went into a VGA cards. RAM, RamDAC, BIOS, Memory controller, Blitter, Ram Refresh, Cache controller, Timing Sequencer\footnote{Tseng Labs ET4000} to name only a few, they started to tighly integrate everything need into a single chip.\\
\par
Some manufacture such as Cirrus Logic even adopted a fabless business model where they designed and sold semiconductor chips while outsourcing the fabrication.\\
\par
Graphic card designers also leveraged the fact that VGA RAM was often subject to write operations instead of read and optimized accordingly with FIFO SDRAM cache. Peeking at a card based on Tseng Labs's best seller, the ET4000 give a good overview of what a customer could purchase.\\ 
\par
\cfullimage{vlb_cards/tseng_lans_et4000_w32_vesa_local_illetw32.png}{ILLETW32 Britek Electronics. Photo courtesy \cw{http://www.amoretro.de/}}
\par
The card above was manufactured by Britek Electronics. By licensing the ET4000, they only had to provide RAM(\circled{1}), RAMDAC(\circled{2}) a Timer(\circled{3}) and a XXX(\circled{4}). The VGA BIOS chip (\circled{5}) could only be purchased from Tseng Labs.\\
\par
\drawing{vga_vlb_arch}{}

\par



\subsection{VL-Bus}
As much as the video card manufacturer could optimize their product, there was still a huge bottleneck that was out of their control. Information written by the CPU still had to transit via the ISA bus. Introduce in 198X, After more than ten years of service\footnote{The ISA was introduced in 1981}, the 16-bit ISA running at 8.3 Mhz, was starting to show its age. It saw a performance boost when it was updated to support 16 bits but it was still a performance nightmare.\\
\par
\drawing{bus_isa}{ISA Bus}
\par
Fed up with the state of things, hardware manufacturer teamed together to form the VESA (Video Electronics Standards Association) and created a new Bus standard. They did not go for something complicated, the protocol was exactly the Intel 486 Bus Unit protocol which made it a friction less medium\footnote{This reliance on 486 Bus Unit protocol doomed VLB when Intel released its 586 (Pentium) which had a new and not backward compatible But Unit protocol}.\\
\par 
The VLB doubled the bus data line of the ISA to reach 32-bit and it also increase its frequency to 33 Mhz.\\
\par
The chip design for the VLB controller was relativity simple, because many of the core instructions were hosted by the ISA circuits already on the motherboard, but the actual data passes were on the same local bus as the one used by the CPU.
The speed of the system data bus is based on the clock rate of the motherboard's crystal. 
\drawing{bus_vlb}{VLB Bus}
\par
With its larger bus and higher frequency, the VL-Bus could be 40 to 100 faster than an ISA. \\
\par
During the heyday of the VLB, this was usually 33 MHz, and VLB cards usually ran at half that rate, far outpacing the ISA bus. Some cards ran as fast as 50 MHz, using the full speed of the souped-up system bus. That often caused system crashes, because 50 MHz was outside the VLB specification.\\
\par

\begin{figure}[H]
\centering
  \begin{tikzpicture}[font=\small]
    \begin{axis}[
      width=1.0\textwidth,
      height=0.5\textwidth,
      ybar,
      bar width=70pt,
      ylabel={MIPS},
      ymin=0,
      ytick=\empty,
      xtick=data,
      axis x line=bottom,
      axis y line=left,
      enlarge x limits=0.3,
      symbolic x coords={ISA 8-bit, ISA 16-bit, VLB 32-bit},
      xticklabel style={anchor=base,yshift=-\baselineskip},
      nodes near coords={\pgfmathprintnumber\pgfplotspointmeta}
    ]
      \addplot[fill=black!20,draw=black] coordinates {
        (ISA 8-bit,7.9)
        (ISA 16-bit,15.9)
        (VLB 32-bit, 127.2)
      };
    \end{axis}
   
   \end{tikzpicture}
   \caption{Comparison but bandwidth (MBytes/sec).}
 \end{figure}
\par
The design specification provides two other performance-boosting features: burst mode and bus mastering.\\
\par In burst mode, VLB devices gain complete control of the external data bus for up to four bus cycles, passing up to 16 bytes (128 bits) of data in a single burst.\\
\par Bus mastering allows the VLB controller to arbitrate data transfers between the external data bus and up to three VLB devices without assistance from the CPU. This limit of three devices also limited the maximum number of VLB slots to three and called for the use of a coprocessor. Display-system design is covered in more detail in Tutorial 11, "The Display System: Monitors and Adapters."\\
\par
In the opposite page, three VGA cards available in 1993. The connectors instantly tell you what kind of bus and performances to expect.\\
\begin{itemize}
\item Top: an ATI 8800, with an ISA 8-bit interface.
\item Middle: an ATI Mach32, with an ISA 16-bit interface.
\item Bottom: a Cirrus Logic MachSpeed, with a VLB 32-bit interface.
\end{itemize}
 \pagebreak
\scaledimage{0.93}{vlb_cards/ati8800.png}\\
\par
\scaledimage{0.93}{vlb_cards/ati_mach32.png}\\
\par
\scaledimage{0.93}{vlb_cards/Cirrus_Logic_CL-GD5429.png}\\

