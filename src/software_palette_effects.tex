\section{Palette Effects}
\label{label_palettes}
\begin{wrapfigure}[8]{r}{0.25\textwidth}
\centering
\scaledimage{0.25}{palette.png}
\end{wrapfigure}

Despite its many weaknesses, the VGA had one really cool feature: Its palette. Just 768 bytes were enough to make the entire screen fade toward a color. \doom used fading for three effects which were damage, item pickup, and while wearing radiation suit. To implement this effect, palette were precalculated and stored in the \cw{PLAYPAL} lump. There are fourteen palettes in total. Palette \#0 was the default, used during most of the game.\\
\par
Eight palettes (from \#1 to \#8) were used for emphasis damage and let the player know how badly she was being hit. The effect shifts directly to one of the seven palette based on the amount of damage taken (The higher the damage the higher the staring palette). A screen full red was usually very bad news. If no more damage are taken, the palette fades back to normal (Palette \#1) at the rate of one palette unit every 1/2 second.\\
\par
\scaledimage{0.25}{palette_damage1.png}
\scaledimage{0.25}{palette_damage2.png}
\scaledimage{0.25}{palette_damage3.png}
\scaledimage{0.25}{palette_damage4.png}
\scaledimage{0.25}{palette_damage5.png}
\scaledimage{0.25}{palette_damage6.png}
\scaledimage{0.25}{palette_damage7.png}
\scaledimage{0.25}{palette_damage8.png}\\
\par
Due to an off-by-one bug, palette \#1 is never used. Take a good look at the code selecting the damage palette in \cw{ST\_doPaletteStuff}, It can only generate values within [2..9].\\
\par
\ccode{ST_doPaletteStuff0.c}\\
\par
\ccode{ST_doPaletteStuff.c}\\
\par
Palettes \#9 to \#12 are used briefly when an item is picked up.\\
\par
\scaledimage{0.25}{palette_item1.png}
\scaledimage{0.25}{palette_item2.png}
\scaledimage{0.25}{palette_item3.png}
\scaledimage{0.25}{palette_item4.png}\\
\par
Because of the same off-by-one miscalculation, palette \#9 is never used. The palette selector can only generate offset between [1..3] whereas a [0..3] range was needed.\\
\par
% \ccode{ST_doPaletteStuff2.c}\\
\par
The last palette (\#13) is not used for a fading effects but as a permanent swap when the player is wearing the radiation suit.\\ 
\par

\scaledimage{0.25}{palette_radiationsuit.png}